{% load static tailwind_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ classroom.name }} - Attendance</title>
  {% tailwind_css %}
</head>
<body class="bg-gray-50 min-h-screen">

  <!-- Header -->
  <header class="bg-blue-600 text-white shadow-md">
    <div class="max-w-5xl mx-auto px-6 py-4 flex items-center justify-between">
      <h1 class="text-xl font-bold">{{ classroom.name }} - {{ classroom.subject }}</h1>
      <a href="{% url 'dashboard' %}" class="text-white underline hover:text-gray-200">‚Üê Back</a>
    </div>
  </header>

  <main class="max-w-5xl mx-auto p-6">
    <!-- Top Actions -->
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-semibold text-gray-700">Attendance Records</h2>
      <div class="space-x-3">
        <button id="openModal" class="bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700 transition">
          + Add Attendance
        </button>
        <a href="{% url 'add_student' classroom.id %}" class="bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700 transition">
          + Add Student
        </a>
        <a href="{% url 'delete_class' classroom.id %}" 
        class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition">
        Delete Class
        </a>
        <button onclick="copyLink()" class="bg-gray-200 text-gray-700 px-5 py-2 rounded-lg hover:bg-gray-300 transition">
          üìé Copy Public Link
        </button>
      </div>
    </div>

    <!-- Attendance Table -->
    {% if attendance_records %}
    <div class="overflow-x-auto">
      <table class="min-w-full border border-gray-200 bg-white rounded-xl shadow text-sm">
        <thead class="bg-gray-100 text-gray-700 uppercase">
          <tr>
            <th class="px-4 py-2 text-left">Date</th>
            <th class="px-4 py-2 text-left">Student</th>
            <th class="px-4 py-2 text-left">Status</th>
            <th class="px-4 py-2 text-left">Start</th>
            <th class="px-4 py-2 text-left">End</th>
            <th class="px-4 py-2 text-left">Remarks</th>
          </tr>
        </thead>
        <tbody>
          {% for a in attendance_records %}
          <tr class="hover:bg-blue-50 border-t">
            <td class="px-4 py-2">{{ a.start_time|date:"d M Y" }}</td>
            <td class="px-4 py-2">{{ a.student.name }}</td>
            <td class="px-4 py-2">
              {% if a.status == "Present" %}
                <span class="bg-green-100 text-green-700 px-2 py-1 rounded-md">Present</span>
              {% else %}
                <span class="bg-red-100 text-red-700 px-2 py-1 rounded-md">Absent</span>
              {% endif %}
            </td>
            <td class="px-4 py-2">{{ a.start_time|time:"H:i" }}</td>
            <td class="px-4 py-2">{{ a.end_time|time:"H:i" }}</td>
            <td class="px-4 py-2">{{ a.remarks }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
      <p class="text-gray-600 mt-4">No attendance records yet.</p>
    {% endif %}
  </main>

  <!-- Add Attendance Modal -->
  <div id="attendanceModal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50">
    <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md relative">
      <button id="closeModal" class="absolute top-3 right-4 text-gray-400 hover:text-gray-600">‚úñ</button>
      <h3 class="text-lg font-semibold mb-4 text-gray-800">Add Attendance</h3>

      <form method="post">
        {% csrf_token %}
        <label class="block mb-2 text-gray-700">Select Student</label>
        <select name="student_id" required class="w-full border px-3 py-2 rounded-md mb-3">
          {% for s in students %}
            <option value="{{ s.id }}">{{ s.name }}</option>
          {% endfor %}
        </select>

        <label class="block mb-2 text-gray-700">Start Time</label>
        <input type="datetime-local" name="start_time" required class="w-full border px-3 py-2 rounded-md mb-3">

        <label class="block mb-2 text-gray-700">End Time</label>
        <input type="datetime-local" name="end_time" required class="w-full border px-3 py-2 rounded-md mb-3">

        <label class="block mb-2 text-gray-700">Status</label>
        <select name="status" required class="w-full border px-3 py-2 rounded-md mb-3">
          <option value="Present">Present</option>
          <option value="Absent">Absent</option>
        </select>

        <label class="block mb-2 text-gray-700">Remarks</label>
        <textarea name="remarks" rows="2" class="w-full border px-3 py-2 rounded-md mb-4"></textarea>

        <button type="submit" class="bg-blue-600 text-white w-full py-2 rounded-md hover:bg-blue-700 transition">Save</button>
      </form>
    </div>
  </div>

  <script>
    // Modal logic
    const openModal = document.getElementById('openModal');
    const closeModal = document.getElementById('closeModal');
    const modal = document.getElementById('attendanceModal');

    openModal.onclick = () => modal.classList.remove('hidden');
    closeModal.onclick = () => modal.classList.add('hidden');
    window.onclick = e => { if (e.target === modal) modal.classList.add('hidden'); }

    // Copy link
    function copyLink() {
      const link = window.location.href.replace('class', 'public');
      navigator.clipboard.writeText(link);
      alert("Public view link copied!");
    }
  </script>

</body>
</html>
